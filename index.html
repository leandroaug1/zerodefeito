
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Embed Apps Script</title>
  <style>
    :root {
      --bg: #0f172a;
      --fg: #e2e8f0;
      --muted: #94a3b8;
      --accent: #22c55e;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Ubuntu, "Noto Sans", "Liberation Sans", sans-serif;
    }
    .app {
      display: grid;
      grid-template-rows: auto 1fr;
      height: 100%;
    }
    header {
      display: flex;
      align-items: center;
      gap: .75rem;
      padding: .75rem 1rem;
      border-bottom: 1px solid rgba(148,163,184,.2);
      background: rgba(15,23,42,.6);
      backdrop-filter: blur(6px);
    }
    header h1 {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      color: var(--fg);
      letter-spacing: .2px;
    }
    header .actions {
      margin-left: auto;
      display: flex;
      gap: .5rem;
    }
    .btn {
      appearance: none;
      border: 1px solid rgba(148,163,184,.35);
      background: transparent;
      color: var(--fg);
      padding: .45rem .75rem;
      border-radius: .5rem;
      font-size: .9rem;
      cursor: pointer;
      transition: .2s ease;
    }
    .btn:hover { border-color: var(--fg); }
    .btn.accent {
      border-color: transparent;
      background: var(--accent);
      color: #052e12;
      font-weight: 600;
    }
    .frame-wrap {
      position: relative;
      height: calc(100vh - 56px);
      width: 100%;
      overflow: hidden;
      background: #0b1222;
    }
    iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      background: #fff;
    }
    .fallback {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
      background:
        radial-gradient(1200px 500px at 50% -10%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(600px 240px at 90% 10%, rgba(59,130,246,.10), transparent 60%),
        var(--bg);
    }
    .fallback.show { display: flex; }
    .card {
      width: min(720px, 92vw);
      background: rgba(2,6,23,.65);
      border: 1px solid rgba(148,163,184,.20);
      border-radius: 14px;
      padding: 1.25rem 1.25rem 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .card h2 {
      margin: 0 0 .5rem 0;
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: .2px;
    }
    .card p {
      margin: 0 0 1rem 0;
      color: var(--muted);
      line-height: 1.55;
      font-size: .98rem;
    }
    code {
      background: rgba(148,163,184,.2);
      border: 1px solid rgba(148,163,184,.25);
      padding: .15rem .35rem;
      border-radius: .35rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: .88rem;
      color: #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Embed — Zero Defeito</h1>
      <div class="actions">
        <button class="btn" id="reloadBtn" title="Recarregar embed">Recarregar</button>
        <a class="btn accent" id="openBtn" target="_blank" rel="noopener">Abrir em nova aba</a>
      </div>
    </header>

    <div class="frame-wrap">
      <iframe
        id="embed"
        title="Apps Script"
        loading="eager"
        referrerpolicy="no-referrer"
        allow="clipboard-read; clipboard-write; fullscreen; geolocation *; microphone *; camera *"
        sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-downloads"
        src="https://script.google.com/macros/s/AKfycbxyU56u9NHCbC3qQ9dI1_8SJlXd5JvfI9XAGHs8KU81FWulmVvaDyhPykbqy3E0JJ0wJA/-Frame-Options</code> ou <code>Content-Security-Policy (frame-ancestors)</code>.
          </p>
          <p>
            Você pode abrir diretamente em nova aba:
            <a id="fallbackLink" class="btn accent" style="margin-left:.35rem" target="_blank" rel="noopener">Abrir agora</a>
          </p>
          <p style="margin-top:.75rem">
            Dica: se você controla o Apps Script, publique como Web App e ajuste cabeçalhos para permitir
            a origem do seu domínio (quando aplicável).
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const URL_TARGET = "https://script.google.com/macros/s/AKfycbxyU56u9NHCbC3qQ9dI1_8SJlXd5JvfI9XAGHs8KU81FWulmVvaDyhPykbqy3E0JJ0wJA/exec";

      const iframe = document.getElementById("embed");
      const fallback = document.getElementById("fallback");
      const fallbackLink = document.getElementById("fallbackLink");
      const reloadBtn = document.getElementById("reloadBtn");
      const openBtn = document.getElementById("openBtn");

      fallbackLink.href = URL_TARGET;
      openBtn.href = URL_TARGET;

      // Se o iframe não carregar em X segundos, mostra o fallback.
      const TIMEOUT_MS = 2500;
      let loaded = false;

      const showFallback = () => {
        if (!loaded) {
          fallback.classList.add("show");
        }
      };

      // Marca como carregado quando possível.
      iframe.addEventListener("load", () => {
        loaded = true;
        fallback.classList.remove("show");
      });

      // Se der erro, mostra fallback.
      iframe.addEventListener("error", () => {
        loaded = false;
        showFallback();
      });

      // Timeout defensivo (cobrir bloqueios silenciosos).
      setTimeout(showFallback, TIMEOUT_MS);

      // Recarregar manualmente
      reloadBtn.addEventListener("click", () => {
        loaded = false;
        fallback.classList.remove("show");
        // Força recarregar
        iframe.src = "";
        requestAnimationFrame(() => { iframe.src = URL_TARGET; });
      });

      // Ajuste de altura em mobile iOS (teclado/toolbar)
      const setVH = () => {
        document.documentElement.style.setProperty("--vh", window.innerHeight * 0.01 + "px");
      };
      window.addEventListener("resize", setVH);
      setVH();
    })();
  </script>
</body>
</html>
